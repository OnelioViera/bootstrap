<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Status Checker</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .status-box {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 { color: #333; margin: 0 0 20px 0; }
        .status { 
            font-size: 24px; 
            font-weight: bold; 
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        .checking { background: #d1ecf1; color: #0c5460; }
        .ready { background: #d4edda; color: #155724; }
        .building { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
        button {
            background: #0366d6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover { background: #0256c7; }
        .info { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 4px; 
            margin: 20px 0;
            text-align: left;
        }
        .commit { 
            font-family: monospace; 
            background: #e9ecef; 
            padding: 5px 10px; 
            border-radius: 3px;
        }
        .timestamp { color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <div class="status-box">
        <h1>üöÄ Vercel Deployment Status</h1>
        <p>Check if your latest CMS changes have been deployed</p>
        
        <div id="status" class="status checking">
            Checking deployment status...
        </div>
        
        <div id="details" class="info" style="display: none;"></div>
        
        <button onclick="checkStatus()">üîÑ Check Again</button>
        <button onclick="window.location.href='/'">üè† Go to Site</button>
        <button onclick="window.location.href='/admin/'">‚öôÔ∏è Go to CMS</button>
        
        <div style="margin-top: 30px; padding: 20px; background: #e7f3ff; border-radius: 8px;">
            <h3 style="margin-top: 0;">üí° How It Works</h3>
            <ol style="text-align: left;">
                <li>Save changes in CMS ‚Üí Commits to GitHub</li>
                <li>GitHub triggers Vercel ‚Üí <strong>Wait 30-60 seconds</strong></li>
                <li>Vercel builds and deploys ‚Üí Check status here</li>
                <li>Once "Ready" ‚Üí Refresh your site to see changes</li>
            </ol>
        </div>
    </div>

    <script>
        const GITHUB_API = 'https://api.github.com/repos/OnelioViera/bootstrap/commits/main';
        let lastCommit = null;
        let checkInterval = null;

        async function checkStatus() {
            const statusDiv = document.getElementById('status');
            const detailsDiv = document.getElementById('details');
            
            statusDiv.className = 'status checking';
            statusDiv.textContent = 'üîç Checking latest commit...';
            
            try {
                // Get latest commit from GitHub
                const response = await fetch(GITHUB_API);
                const commit = await response.json();
                
                lastCommit = {
                    sha: commit.sha.substring(0, 7),
                    message: commit.commit.message,
                    date: new Date(commit.commit.author.date),
                    author: commit.commit.author.name
                };
                
                // Check if content files were modified
                const filesResponse = await fetch(`https://api.github.com/repos/OnelioViera/bootstrap/commits/${commit.sha}`);
                const commitDetails = await filesResponse.json();
                const hasContentChanges = commitDetails.files.some(f => f.filename.startsWith('content/'));
                
                // Calculate time since commit
                const now = new Date();
                const timeSince = Math.floor((now - lastCommit.date) / 1000); // seconds
                
                detailsDiv.style.display = 'block';
                detailsDiv.innerHTML = `
                    <strong>Latest Commit:</strong> <span class="commit">${lastCommit.sha}</span><br>
                    <strong>Message:</strong> ${lastCommit.message}<br>
                    <strong>Author:</strong> ${lastCommit.author}<br>
                    <strong>Time:</strong> <span class="timestamp">${lastCommit.date.toLocaleString()}</span><br>
                    <strong>Age:</strong> ${formatTime(timeSince)}<br>
                    <strong>Content Changed:</strong> ${hasContentChanges ? '‚úÖ Yes' : '‚ùå No'}
                `;
                
                // Estimate deployment status
                if (timeSince < 30) {
                    statusDiv.className = 'status building';
                    statusDiv.innerHTML = '‚è≥ Building...<br><small>Wait ~' + (30 - timeSince) + ' more seconds</small>';
                } else if (timeSince < 90) {
                    statusDiv.className = 'status building';
                    statusDiv.innerHTML = '‚è≥ Deploying...<br><small>Should be ready soon</small>';
                } else {
                    statusDiv.className = 'status ready';
                    statusDiv.innerHTML = '‚úÖ Deployment Ready!<br><small>Safe to refresh your site now</small>';
                }
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Error checking status: ' + error.message;
            }
        }
        
        function formatTime(seconds) {
            if (seconds < 60) return seconds + ' seconds ago';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return minutes + ' minute' + (minutes > 1 ? 's' : '') + ' ago';
            const hours = Math.floor(minutes / 60);
            return hours + ' hour' + (hours > 1 ? 's' : '') + ' ago';
        }
        
        // Auto-check every 10 seconds
        function startAutoCheck() {
            checkStatus();
            checkInterval = setInterval(checkStatus, 10000);
        }
        
        // Start checking on load
        window.addEventListener('DOMContentLoaded', startAutoCheck);
    </script>
</body>
</html>
